<!DOCTYPE html>
<html lang="en">
    <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Hugo 0.15" />
    <title>Tutorial: ASP.NET (C#) WCF WebHttp service with jQuery: Part 1 - Loan object &middot; James Skemp&#39;s Test Hugo-Generated Site</title>
    
    
    
    <meta name="description" content="" />
    <meta name="keywords" content='asp.net,.net,c#' />
    <meta name="author" content="" />
    <link href="" rel="alternate" type="application/rss+xml" title="James Skemp&#39;s Test Hugo-Generated Site" />
    <link rel="stylesheet" href="http://jamesskemp.github.io/words/css/bootstrap.min.css" />
    <link rel="stylesheet" href="http://jamesskemp.github.io/words/css/highlightjs-themes/androidstudio.css" />
    <link rel="stylesheet" href="http://jamesskemp.github.io/words/css/font-awesome.min.css" />
    <link rel="stylesheet" href="http://jamesskemp.github.io/words/css/phlat.css" />
</head>

    <body>
        <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://jamesskemp.github.io/words/">James Skemp&#39;s Test Hugo-Generated Site</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                
            </ul>
        </div>
    </div>
</nav>

        <div id="top" class="container">
            <div class="row" id="content-main">
                <div class="col-md-8">
                    <div class="row">
    <div class="col-md-12 content-card">
        <h1>Tutorial: ASP.NET (C#) WCF WebHttp service with jQuery: Part 1 - Loan object</h1>
        
            
            <ul class="list-inline meta">
                <li><i class="fa fa-calendar"></i>June 22, 2010</li>
                <li><i class="fa fa-user"></i>
					
					James Skemp
					
				</li>
                <li><i class="fa fa-folder"></i><a href="http://jamesskemp.github.io/words/categories/tutorials-/-guides">tutorials / guides</a></li>
            </ul>
        
        <p><div class="note">
<p>See the <a href="http://strivinglife.com/words/post/Tutorial-ASPNET-C-sharp-WCF-WebHttp-service-with-jQuery-Table-of-Contents.aspx">table of contents</a> for more information.</p>
</div>
<p>As already noted in the table of contents, the end goal will to have a service that returns enough information to be able to generate an amortization&nbsp;schedule for a loan. I&rsquo;m not in financial services, and haven&rsquo;t been very good in math since some point in high school, but this seems to work fairly well.</p>
<p>The first thing we&rsquo;re going to do is generate an assembly that we&rsquo;ll then use in the WCF WebHttp service. We&rsquo;ll then create a service that works with this, and finally the jQuery to get information out of the service and display it.</p>
<h3>Defining the loan object</h3>
<p>A loan consists of a total amount due, an amount paid per payment, the number of payments made&nbsp; and the interest rate, per year. While not necessary, since we may want multiple loans to be available at once, we&rsquo;ll also say that loans can have a name, or description.</p>
<p>While Decimal may be better, that gives us something like this for our class.</p>
<pre class="code"><code class="csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Data;</p>

<p>namespace JamesRSkemp.Formulas {
    public class Amortization {</p>

<pre><code>    /// &amp;lt;summary&amp;gt;
    /// Loan, with a total amount due, payment amount, number of payments per year, and interest rate per year.
    /// &amp;lt;/summary&amp;gt;
    public class Loan {
        /// &amp;lt;summary&amp;gt;
        /// Name of the loan.
        /// &amp;lt;/summary&amp;gt;
        public String Name { get; set; }
        /// &amp;lt;summary&amp;gt;
        /// Total amount due on the loan.
        /// &amp;lt;/summary&amp;gt;
        public Double Total { get; set; }
        /// &amp;lt;summary&amp;gt;
        /// The amount paid per payment.
        /// &amp;lt;/summary&amp;gt;
        public Double PaymentAmount { get; set; }
        /// &amp;lt;summary&amp;gt;
        /// The number of payments made per year. Usually 12.
        /// &amp;lt;/summary&amp;gt;
        public int PaymentsPerYear { get; set; }
        /// &amp;lt;summary&amp;gt;
        /// Percent of interest, per year.
        /// &amp;lt;/summary&amp;gt;
        public Double InterestPerYear { get; set; }
        /// &amp;lt;summary&amp;gt;
        /// List of individual payments. Only populated/updated by UpdatePayments method.
        /// &amp;lt;/summary&amp;gt;
        public List&amp;lt;Payment&amp;gt; Payments { get; set; }

        /// &amp;lt;summary&amp;gt;
        /// Creates a new instance of a loan. By default sets the number of payments per year to 12.
        /// &amp;lt;/summary&amp;gt;
        public Loan() {
            this.PaymentsPerYear = 12;
        }
    }
}
</code></pre>

<p>}</code></pre>
<p>You&rsquo;ll notice that I&rsquo;m setting the number of payments per year to 12 when the object is initialized, as most loans tend to follow that.</p>
<p>We have payments defined separately, which I&rsquo;ve defined as follows.</p>
<pre class="code"><code class="csharp">/// &lt;summary&gt;
/// Loan payment.
/// &lt;/summary&gt;
public class Payment {
    /// &lt;summary&gt;
    /// Total payment amount.
    /// &lt;/summary&gt;
    public Double Total { get; set; }
    /// &lt;summary&gt;
    /// Amount of payment applied to interest.
    /// &lt;/summary&gt;
    public Double Interest { get; set; }
    /// &lt;summary&gt;
    /// Amount of payment applied to the principal.
    /// &lt;/summary&gt;
    public Double Principal { get; set; }
    /// &lt;summary&gt;
    /// Amount of the loan remaining after this payment is made.
    /// &lt;/summary&gt;
    public Double LoanRemaining { get; set; }
    /// &lt;summary&gt;
    /// New loan payment.
    /// &lt;/summary&gt;
    public Payment() {
    }
}</code></pre>
<p>You can see that I&rsquo;ve assumed a payment will have a total amount paid, with what amount went towards interest and what towards the principal. For tracking ease, I&rsquo;ve also put the loan&rsquo;s remaining amount on the payment as well, although this isn&rsquo;t really necessary. Of course, we don&rsquo;t have a date associated with the payment (which might be a good idea for expansion purposes), so perhaps it is.</p>
<p>Now we have to come up with some way to populate the payments. For this purpose I&rsquo;ve added a method to Loan object which allows the payments to be populated, or updated.</p>
<pre class="code"><code class="csharp">/// &lt;summary&gt;
/// Updates payments on a loan.
/// &lt;/summary&gt;
/// &lt;returns&gt;If payments cannot be updated, returns false.&lt;/returns&gt;
public Boolean UpdatePayments() {
    Boolean paymentsUpdated = false;</p>

<pre><code>if (this.Payments == null) {
    this.Payments = new List&amp;lt;Payment&amp;gt;();
} else {
    this.Payments.Clear();
}

// Determine how much interest should be applied per payment.
Double interestPerPayment = (this.InterestPerYear / 100) / this.PaymentsPerYear;

// Store how much we need to pay. In this case, what the first payment will be.
Double periodPaymentAmount = interestPerPayment * this.Total;

if (periodPaymentAmount &amp;gt;= this.PaymentAmount) {
    throw new Exception(&quot;The amount of interest on the first payment is greater than the amount that will be paid.&quot;);
} else {
    Double totalRemaining = this.Total;

    while (totalRemaining &amp;gt; 0) {
        Payment currentPayment = new Payment();
        currentPayment.Total = this.PaymentAmount;
        currentPayment.Interest = Math.Round(totalRemaining * interestPerPayment, 2);
        currentPayment.Principal = Math.Round(currentPayment.Total - currentPayment.Interest, 2);
        currentPayment.LoanRemaining = Math.Round(totalRemaining - currentPayment.Principal, 2);
                    // If we now have a remaining amount on the loan less than 0, we've paid too much.

        if (currentPayment.LoanRemaining &amp;lt; 0) {
            currentPayment.Total += currentPayment.LoanRemaining;
            currentPayment.Principal += currentPayment.LoanRemaining;
            currentPayment.LoanRemaining = 0;
        }

        this.Payments.Add(currentPayment);

        totalRemaining = currentPayment.LoanRemaining;
        currentPayment = null;
    }
    paymentsUpdated = true;
}

return paymentsUpdated;
</code></pre>

<p>}</code></pre>
<p>You can see that this clears any existing payment information, then loops through and generates a list of payments, which are then associated with the loan. In case the remaining amount due is less than 0, we take that from the payment amount and principal paid to zero the loan.</p>
<h3>Testing this out</h3>
<p>At this point you&rsquo;re more than willing to create a simple command-line client that references this assembly. You can also grab a copy of <a rel="external download" href="http://media.jamesrskemp.com/articles/JamesRSkemp.Formulas.Amortization.cs.txt">JamesRSkemp.Formulas.Amortization</a> online, and compare results with a slightly different version that I use in my <a rel="external" href="http://jamesrskemp.com/testing/asp.net/Amortization.aspx">amortization schedule generator</a>.</p>
<h3>Next time &hellip;</h3>
<p>Now that we have this assembly ready we can look at the next piece, which will be to generate the WCF WebHttp service that actually makes use of this.</p></p>

        
    <ul class="list-inline tags" style="margin-top: 15px; margin-left: 0px">
        
            <li style=""><a href="http://jamesskemp.github.io/words/tags/asp.net">asp.net</a></li>
        
            <li style=""><a href="http://jamesskemp.github.io/words/tags/.net">.net</a></li>
        
            <li style=""><a href="http://jamesskemp.github.io/words/tags/c">c#</a></li>
        
    </ul>


    </div>
</div>

                    
    
        <div class="row">
            <div class="col-md-12 content-card">
                <div id="disqus_thread"></div>
                <script>
                    (function() {
                        if (window.location.hostname == "localhost") {
                            document.write("Disqus comments are unavailable while serving on localhost or 127.0.0.1");
                            return;
                        }
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        var disqus_shortname = 'strivinglife';
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </div>
        </div>
    


                </div>
                <div class="col-md-4">
                    <div class="row">
    <div class="col-md-11 col-md-offset-1 card">
        <h5>Search</h5>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
            <div class="input-group">
                <input class="form-control" type="search" name="q" />
                <span class="input-group-btn">
                    <button class="btn btn-custom" type="submit"><span class="glyphicon glyphicon-search"></span></button>
                </span>
            </div>
            <input type="hidden" name="q" value="site:http://jamesskemp.github.io/words/">
        </form>
    </div>
</div>

                    <div class="row">
    <div class="col-md-11 col-md-offset-1 card">
        <h5>Recent Posts</h5>
        <ul class="list-unstyled posts-recent">
            <ul class="list-unstyled posts-recent">
                
                    <li><a href="http://jamesskemp.github.io/words/post/Review-Amazon-Fire-7-2015-release-Case/">Review: Amazon Fire 7 (2015 release) Case</a></li>
                
                    <li><a href="http://jamesskemp.github.io/words/post/review-alienware-steam-machine-asm100-4980blk-desktop-console/">Review: Alienware Steam Machine ASM100-4980BLK Desktop Console (Intel Core i5, 8 GB RAM, 1 TB HDD) NVIDIA GeForce GTX GPU</a></li>
                
                    <li><a href="http://jamesskemp.github.io/words/post/review-zagg-slim-cover-surface-4-mc3wkk-bb0/">Review: ZAGG Slim Cover, Ultra-Slim Bluetooth Tablet Keyboard for Microsoft Surface Pro 3 and 4 (MC3WKK-BB0)</a></li>
                
                    <li><a href="http://jamesskemp.github.io/words/post/review-sennheiser-hd-471g-headset/">Review: Sennheiser HD 471G Headset with Inline Mic and 3 Button Control</a></li>
                
                    <li><a href="http://jamesskemp.github.io/words/post/Review-Amazon-Fire-HD-8-2015-release-Case/">Review: Amazon Fire HD 8 (2015 release) Case</a></li>
                
            </ul>
        </ul>
    </div>
</div>

                    <div class="row">
	<div class="col-md-11 col-md-offset-1 card">
		<ins class="adsbygoogle"
			style="display:block"
			data-ad-client="ca-pub-3526066001929698"
			data-ad-slot="3689523691"
			data-ad-format="auto">
		</ins>
	</div>
</div>

                    
    
        <div class="row">
            <div class="col-md-11 col-md-offset-1 card">
                <h5>categories</h5>
                <ul class="list-unstyled posts-recent">
                    
                        <li><a href="http://jamesskemp.github.io/words/categories/software">software</a></li>
                    
                        <li><a href="http://jamesskemp.github.io/words/categories/article">article</a></li>
                    
                        <li><a href="http://jamesskemp.github.io/words/categories/review">review</a></li>
                    
                        <li><a href="http://jamesskemp.github.io/words/categories/strivinglife">strivinglife</a></li>
                    
                        <li><a href="http://jamesskemp.github.io/words/categories/philosophy">philosophy</a></li>
                    
                        <li><a href="http://jamesskemp.github.io/words/categories/tutorials-/-guides">tutorials-/-guides</a></li>
                    
                        <li><a href="http://jamesskemp.github.io/words/categories/dvd-/-movie">dvd-/-movie</a></li>
                    
                        <li><a href="http://jamesskemp.github.io/words/categories/internet">internet</a></li>
                    
                        <li><a href="http://jamesskemp.github.io/words/categories/gaming">gaming</a></li>
                    
                        <li><a href="http://jamesskemp.github.io/words/categories/technology">technology</a></li>
                    
                </ul>
            </div>
        </div>
    

    


                    
	<div class="row">
		<div class="col-md-11 col-md-offset-1 card">
			<h5>Support This Site</h5>
			<p>
				If my blog was helpful to you, then please consider visiting my
				<a href="http://amzn.to/22xk0cK" rel="external">Amazon Wishlist</a>.
			</p>
		</div>
	</div>

                </div>
            </div>
        </div>
        <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-8 col-xs-6">
    <ul class="list-inline links">
        
    </ul>
</div>

            <div class="col-md-4 col-xs-6">
    <ul class="list-inline social-media">
        
        
        
        
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-md-12">
                <p>
                    Generated using <a href="https://gohugo.io/" rel="external">Hugo</a> and the <a href="https://github.com/nraboy/hugo-phlat-theme" rel="external">Phlat Theme</a>.
                </p>
            </div>
        </div>
    </div>
</footer>

        <div id="back-to-top" class="hidden">
    <a href="#top" class="well well-sm" onclick="$('html,body').animate({scrollTop:0},'slow');return false;">
        <i class="glyphicon glyphicon-chevron-up"></i> Back to Top
    </a>
</div>
<script src="http://jamesskemp.github.io/words/js/jquery-2.2.1.min.js"></script>
<script src="http://jamesskemp.github.io/words/js/bootstrap.min.js"></script>
<script src="http://jamesskemp.github.io/words/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
    if(($(window).height() + 100) < $(document).height()) {
        $('#back-to-top').removeClass('hidden').affix({
            offset: {
                top: 100
            }
        });
    }
</script>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
    
    if (window.location.hostname == "localhost") {
        $(".adsbygoogle").css("text-decoration", "none");
        $(".adsbygoogle").text("Adsense is unavailable while serving on localhost or 127.0.0.1");
    } else {
        [].forEach.call(document.querySelectorAll('.adsbygoogle'), function() {
            (adsbygoogle = window.adsbygoogle || []).push({});
        });
    }
</script>



    </body>
</html>
